# **TROUBLESHOOTING RATING-OPERATOR**

This document aim to helps users solve common problems they might encounter while using the rating-operator.
Some problems listed below might be fixed by coming updates, the document will change accordingly.
If you encounter an error not documented here, feel free to open an issue to discuss it, and we will add it here.

## Common advices

All the advices below are to be taken serially.

- When installing the `metering-operator`, we recommand waiting the first `reports` generation before installing the `rating`.
- After `rating` installation, you should wait some time to be sure everything initialized correctly. To test it you can:
```sh
$> kubectl get pods -l app.kubernetes.io/component=api -o name | cut -d/ -f2 | xargs -I{} kubectl port-forward {} 5012:5012
Forwarding from 127.0.0.1:5012 -> 5012
Forwarding from [::1]:5012 -> 5012
# From another terminal
$> curl http://localhost:5012/alive
I'm alive!
```
- When adding a new configuration, after creating your `RatingRules`, always verify validity by looking at the events of it, otherwise your rating will not start:
```sh
$> kubectl -n $RATING_NAMESPACE  describe ratingrules.rating.alterway.fr test-rules
 Type    Reason   Age   From  Message
  ----    ------   ----  ----  -------
  Normal  Logging  43m   kopf  RatingRule test-rules created, valid from 2020-04-22T12:46:41Z.

```
- Do **NOT** create or modify `RatedMetrics` yourself, it should do no harm but it's not designed to be used that way.


## Common questions

> I just installed the rating and nothing is happening

As the rating is watching the `reports` generated by the `metering-operator`, you might have to wait as long as one hour to start seing results.
Reports are generated every hour at *HH:00*, so you can expect to get `RatedMetrics` soon after (seconds, in our case, 500 frames per metrics takes 1.4 seconds).


> I waited till next hour but nothing is happening

What can happen here is related to the configuration versionning system. To explain simply, if you deploy the `rating` without waiting for the first `reports` to be generated, the rating will try to rates frames that have timestamp contained between 0 and the hour of deployment of the operator, thus finding nothing to rate, ever.
The easy fix for this situation is to delete then recreate your `RatingRules`.
